<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emprendimientos Femeninos - Vista P√∫blica</title>
    <style>
        /* [Mantener todos los estilos CSS anteriores] */
        .spinner {
            border: 4px solid rgba(0,0,0,0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #0d47a1;
            animation: spin 1s linear infinite;
            margin: 40px auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Emprendimientos Femeninos</h1>
            <p class="subtitle">Descubre y apoya negocios liderados por mujeres</p>
        </div>
    </header>

    <div class="container">
        <div class="filtros">
            <button class="filtro-btn active" data-sector="todos">üåü Todos</button>
            <button class="filtro-btn" data-sector="Alimentos y Bebidas">üçè Alimentos</button>
            <button class="filtro-btn" data-sector="Artesan√≠as">üé® Artesan√≠as</button>
            <button class="filtro-btn" data-sector="Belleza y Cuidado Personal">üíÑ Belleza</button>
            <button class="filtro-btn" data-sector="Moda y Accesorios">üëó Moda</button>
            <button class="filtro-btn" data-sector="Tecnolog√≠a">üíª Tecnolog√≠a</button>
            <button class="filtro-btn" data-sector="Educaci√≥n">üìö Educaci√≥n</button>
            <button class="filtro-btn" data-sector="Salud y Bienestar">üè• Salud</button>
            <button class="filtro-btn" data-sector="Articulos de Novedad">üéÅ Novedades</button>
            <button class="filtro-btn" data-sector="Otros">‚ú® Otros</button>
        </div>

        <div id="spinner" class="spinner"></div>
        <div id="contenedor" class="tarjetas">
            <p class="sin-resultados">Cargando emprendimientos...</p>
        </div>

        <center>
            <button id="btn-admin" class="admin-link">üîí Acceso Administradores</button>
        </center>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modal-info"></div>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 style="text-align:center; color:#0d47a1;">Acceso Administrativo</h3>
            <form id="loginForm">
                <input type="text" id="usuario" placeholder="Usuario" required>
                <input type="password" id="password" placeholder="Contrase√±a" required>
                <button type="submit">Ingresar</button>
                <p id="loginError" class="login-error">Credenciales incorrectas</p>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const URL_SCRIPT = 'https://script.google.com/macros/s/AKfycbzMOed4cwo-HIxgYYB5xYS2M5S9_o_xOeQ_mxEEP1tlCT1mNZjHGIZdz_NuStOY8cSO/exec';
            const CREDENCIALES = {
                usuario: "admin",
                password: "emprendedoras2024"
            };

            const contenedor = document.getElementById('contenedor');
            const modal = document.getElementById('modal');
            const modalInfo = document.getElementById('modal-info');
            const loginModal = document.getElementById('loginModal');
            const btnAdmin = document.getElementById('btn-admin');
            const loginForm = document.getElementById('loginForm');
            const loginError = document.getElementById('loginError');
            const closeButtons = document.querySelectorAll('.close');
            const filtros = document.querySelectorAll('.filtro-btn');
            const spinner = document.getElementById('spinner');

            // Cargar datos desde Google Sheets
            async function cargarDatos() {
                spinner.style.display = 'block';
                contenedor.innerHTML = '';
                
                try {
                    const response = await fetch(URL_SCRIPT);
                    const data = await response.json();
                    
                    if (!Array.isArray(data)) {
                        throw new Error("Formato de datos inv√°lido");
                    }
                    
                    sessionStorage.setItem('emprendimientosPublicos', JSON.stringify(data));
                    return data;
                } catch (error) {
                    console.error("Error al cargar datos:", error);
                    contenedor.innerHTML = `
                        <p class="sin-resultados">
                            Error al cargar los emprendimientos. Intenta recargar la p√°gina.
                        </p>
                    `;
                    return [];
                } finally {
                    spinner.style.display = 'none';
                }
            }

            // Mostrar emprendimientos con filtro
            async function mostrarEmprendimientos(sector = 'todos') {
                const datos = await cargarDatos();
                contenedor.innerHTML = '';
                
                if (datos.length === 0) {
                    contenedor.innerHTML = '<p class="sin-resultados">No hay emprendimientos registrados a√∫n</p>';
                    return;
                }

                const filtrados = sector === 'todos' 
                    ? datos 
                    : datos.filter(emp => emp.sector === sector);

                if (filtrados.length === 0) {
                    contenedor.innerHTML = '<p class="sin-resultados">No hay emprendimientos en esta categor√≠a</p>';
                    return;
                }

                filtrados.forEach(emp => {
                    const card = document.createElement('div');
                    card.className = 'negocio';
                    card.innerHTML = `
                        <img src="${emp.imagen}" 
                             onerror="this.src='https://via.placeholder.com/500x300?text=Imagen+no+disponible'"
                             alt="${emp.nombre}">
                        <h3>${emp.nombre}</h3>
                        <p><strong>${emp.productos}</strong></p>
                        <span class="sector">${emp.sector}</span>
                        <p style="margin-top:15px; color:#0d47a1; font-weight:500;">
                            üëÜ Haz clic para ver detalles
                        </p>
                    `;
                    card.addEventListener('click', () => mostrarDetalles(emp));
                    contenedor.appendChild(card);
                });
            }

            // Mostrar detalles en modal
            function mostrarDetalles(emp) {
                modalInfo.innerHTML = `
                    <img src="${emp.imagen}" class="modal-img"
                         onerror="this.src='https://via.placeholder.com/800x400?text=Imagen+no+disponible'"
                         alt="${emp.nombre}">
                    
                    <h2 style="color:#0d47a1; margin-bottom:15px;">${emp.nombre}</h2>
                    
                    <div class="info-box">
                        <p><strong>üìã Productos/Servicios:</strong> ${emp.productos}</p>
                        <p><strong>üè∑Ô∏è Sector:</strong> ${emp.sector}</p>
                    </div>
                    
                    <div class="info-box">
                        <p><strong>üìû Contacto:</strong> ${emp.contacto}</p>
                        ${emp.direccion ? `<p><strong>üìç Direcci√≥n:</strong> ${emp.direccion}</p>` : ''}
                    </div>
                    
                    <img src="${emp.foto}" class="persona-img" 
                         onerror="this.src='https://via.placeholder.com/200?text=Foto+no+disponible'"
                         alt="Emprendedora: ${emp.nombre}">
                    
                    ${(emp.facebook || emp.instagram) ? `
                    <div class="redes">
                        ${emp.facebook ? `<a href="${emp.facebook.includes('://') ? emp.facebook : 'https://'+emp.facebook}" 
                                           target="_blank">Facebook</a>` : ''}
                        ${emp.instagram ? `<a href="${emp.instagram.includes('://') ? emp.instagram : 'https://'+emp.instagram}" 
                                             target="_blank">Instagram</a>` : ''}
                    </div>` : ''}
                    
                    <p style="text-align:center; margin-top:20px; color:#777;">
                        <small>üìÖ Registrado el: ${emp.fechaRegistro || 'Fecha no disponible'}</small>
                    </p>
                `;
                modal.style.display = 'flex';
            }

            // Mostrar modal de login
            btnAdmin.addEventListener('click', () => {
                loginModal.style.display = 'flex';
            });

            // Validar credenciales
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const usuario = document.getElementById('usuario').value;
                const password = document.getElementById('password').value;
                
                if(usuario === CREDENCIALES.usuario && password === CREDENCIALES.password) {
                    const session = {
                        logged: true,
                        expires: Date.now() + 3600000 // 1 hora
                    };
                    sessionStorage.setItem('adminAuth', JSON.stringify(session));
                    window.location.href = 'galeria.html';
                } else {
                    loginError.style.display = 'block';
                    setTimeout(() => {
                        loginError.style.display = 'none';
                    }, 3000);
                }
            });

            // Cerrar modales
            closeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    modal.style.display = 'none';
                    loginModal.style.display = 'none';
                });
            });

            window.addEventListener('click', (e) => {
                if (e.target === modal) modal.style.display = 'none';
                if (e.target === loginModal) loginModal.style.display = 'none';
            });

            // Configurar filtros
            filtros.forEach(btn => {
                btn.addEventListener('click', () => {
                    filtros.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    mostrarEmprendimientos(btn.dataset.sector);
                });
            });

            // Inicializaci√≥n
            mostrarEmprendimientos();
        });
    </script>
</body>
</html>
